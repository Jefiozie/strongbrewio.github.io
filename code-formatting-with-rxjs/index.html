<!DOCTYPE html>
<html>
<head>
    <!-- Document Settings -->
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <!-- Page Meta -->
    <title>Code formatting and RxJS</title>
    <meta name="description" content="" />

    <!-- Mobile Meta -->
    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Brand icon -->
    <link rel="shortcut icon" href="/assets/images/favicon.ico" >

    <!-- Styles'n'Scripts -->
    <link rel="stylesheet" type="text/css" href="/assets/css/screen.css" />
    <link href="https://fonts.googleapis.com/css?family=Montserrat" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Merriweather:300,700,700italic,300italic|Open+Sans:700,400" />

    <!-- highlight.js -->
    <link href="/assets/css/prism.css" rel="stylesheet">

    <!-- Ghost outputs important style and meta data with this tag -->
        <link rel="canonical" href="https://blog.strongbrew.io//code-formatting-with-rxjs/" />
    <meta name="referrer" content="origin" />
    <link rel="next" href="/page2/" />

    <meta property="og:site_name" content="Strongbrew" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="Code formatting and RxJS" />
    <meta property="og:description" content="" />
    <meta property="og:url" content="https://blog.strongbrew.io///code-formatting-with-rxjs/" />
    <meta property="og:image" content="/assets/images/cover/cover4.jpg" />

    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Code formatting and RxJS" />
    <meta name="twitter:description" content="" />
    <meta name="twitter:url" content="https://blog.strongbrew.io///code-formatting-with-rxjs/" />
    <meta name="twitter:image:src" content="/assets/images/cover/cover4.jpg" />

    <script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "Website",
    "publisher": "Strongbrew",
    "name": "Code formatting and RxJS",
    "url": "https://blog.strongbrew.io///code-formatting-with-rxjs/",
    "image": "/assets/images/cover/cover4.jpg",
    "description": ""
}
    </script>

    <meta name="generator" content="Jekyll 3.0.0" />
    <link rel="alternate" type="application/rss+xml" title="Strongbrew" href="/feed.xml" />


</head>
<body class="home-template nav-closed">
    <div class="topbar">
        <div class="container">
            <a class="logo-wrapper" href="https://strongbrew.io">
                <img src="/assets/images/logo_website.png" alt="">
            </a>
            <div class="menu-wrapper">
                <ul class="menu">
                    <li><a href="https://strongbrew.io/about">Home</a></li>
                    <li><a href="https://strongbrew.io/brews" rel="noopener" routerLinkActive="active">Brews</a></li>
                    <li><a href="/" class="active">Blog</a></li>
                    <li><a href="https://strongbrew.io/consultancy" rel="noopener" routerLinkActive="active">Consultancy</a></li>
                    <li><a href="https://strongbrew.io/contact" rel="noopener" routerLinkActive="active">Contact</a></li>
                </ul>
            </div>
        </div>
    </div>

    <!-- The blog navigation links -->
    <div class="nav">
    <h3 class="nav-title">Menu</h3>
    <a href="#" class="nav-close">
        <span class="hidden">Close</span>
    </a>
    <ul>
        <li class="nav-home " role="presentation"><a
                href="/">Home</a></li>
        <li class="nav-about " role="presentation"><a
                href="/about">About</a></li>
        
            <li class="nav-fables " role="presentation"><a href="/tag/AngularJS">AngularJS</a>
        
            <li class="nav-fables " role="presentation"><a href="/tag/Angular">Angular</a>
        
            <li class="nav-fables " role="presentation"><a href="/tag/Redux">Redux</a>
        
            <li class="nav-fables " role="presentation"><a href="/tag/RxJS">RxJS</a>
        
            <li class="nav-fables " role="presentation"><a href="/tag/Typescript">Typescript</a>
        
            <li class="nav-fables " role="presentation"><a href="/tag/Nx">Nx</a>
        
            <li class="nav-fables " role="presentation"><a href="/tag/@ngrx">@ngrx</a>
        
        <li class="nav-author " role="presentation"><a
                href="/author/brechtbilliet">Brecht</a></li>
        <li class="nav-author " role="presentation"><a
                href="/author/kwintenp">Kwinten</a></li>
    </ul>
    <a class="subscribe-button icon-feed" href="/feed.xml">Subscribe</a>
</div>
<span class="nav-cover"></span>


    <div class="site-wrapper">

        <!-- All the main content gets inserted here, index.hbs, post.hbs, etc -->
        <!-- default -->
<!-- The comment above "< default" means - insert everything in this file into -->
<!-- the [body] of the default.hbs template, which contains our header/footer. -->

<!-- Everything inside the #post tags pulls data from the post -->
<!-- #post -->

<header id="header" class="main-header post-head "
        style="background-image: url(/assets/images/cover/cover4.jpg) ">
    <nav class="main-nav  overlay  clearfix">
        
        <a class="menu-button icon-menu" href="#"><span class="word">Menu</span></a>
        
    </nav>
</header>

<div class="followme followme-abs" id="followme">
<h5>Want to work with us?</h5>
<a href="https://strongbrew.io/about" class="button" rel="noopener">Learn more</a>
</div>


<script type="text/javascript">
    var followMe = document.getElementById('followme');
    var header = document.getElementById('header');
    window.addEventListener('scroll', function() {
        if(window.scrollY > header.offsetHeight + 113) {
            followMe.classList.remove('followme-abs');
            followMe.classList.add('followme-fixed');
        } else {
            followMe.classList.remove('followme-fixed');
            followMe.classList.add('followme-abs');
        }
    });
</script>


<main class="content" role="main">

    <article class="post">
        <div class="post-inner">
            <header class="post-header">
                <h1 class="post-title">Code formatting and RxJS</h1>
                <section class="post-meta">
                    <!-- <a href='/'></a> -->

                    
                    
                    
                    
                    <a href='/author/kwintenp'>Kwinten Pisman</a>
                    
                    
                    <time class="post-date" datetime="2017-09-08">08 Sep 2017
                    </time>
                    <!-- [[tags prefix=" on "]] -->
                    
                    on
                    
                    
                    <a href='/tag/RxJS'>Rxjs</a>
                    
                    
                    
                </section>
            </header>

            <section class="post-content">

                <p>One of the main benefits of RxJS to me is that it provides code that is ‘readable’. It provides us with a declarative programming approach where implementation details are hidden away. We are just describing what needs to be done, not how it should be done. This makes code you look at easy to understand.</p>

<p>One problem that I face regularly when looking at other peoples code is that the code formatting or the way the (RxJS) code is written, takes away part of the benefit of writing your code this way. This post is a small summary on how I like to format my code to keep the readability benefits to a maximum.</p>

<h3 id="one-operator-per-line">One operator per line</h3>

<p>One thing I see all the time is something like this:</p>

<pre><code class="language-typescript">Rx.Observable.pipe(interval(1000),map(x =&gt; x*2),filter(x =&gt; x%2 === 0),
	mergeMap(x =&gt; someBackendCall(x)),map(res =&gt; res.json()).subscribe();
</code></pre>

<p>Here we can see a simple stream. Looking at what is does is a little more difficult however because of the outlining of the operators. If you format the code like this, it makes it so much easier:</p>

<pre><code class="language-typescript">Rx.Observable.interval(1000)
   .pipe(
	   map(x =&gt; x*2),
	   filter(x =&gt; x%2 === 0),
	   mergeMap(x =&gt; someBackendCall(x)),
	   map(res =&gt; res.json())
	)
	.subscribe();
</code></pre>

<p>By putting every operator on a new line, it is so much easier to see what’s happening.</p>

<h3 id="using-nested-functions-for-functions-longer-than-one-line">Using nested functions for functions longer than one line</h3>

<p>A lot of the RxJS operators will accept functions as parameters. These functions can influence the code formatting and impair the readability. Let’s take a look at an example:</p>

<pre><code class="language-typescript">// A data$ stream
private data$: Observable&lt;Array&lt;Data&gt;&gt;;

// A function that uses this data$ 
doSomething() {
    this.data$
    	.pipe(
    	   take(1),
           map((data) =&gt; {
               if (data &amp;&amp; data.length &gt; 0) {
                   	return data.forEach(datum =&gt; {
                       datum.active = false;
                    });
               } else {
            		return [];
               }
           }),
           mergeMap((data) =&gt; {
               data.forEach(datum =&gt; {
                   this.whateverService.update(data);
               });
           })
        )
        .subscribe();
}
</code></pre>

<p>We have a function <code>doSomething()</code> that, when called, will use the <code>data$</code> stream as a source and will perform a mapping of the data array events inside of this stream and then will perform a backend call for every element inside this array. 
If you were able to detect this immediately, my hat off to you. To me however, this looks pretty bad. Let’s take a look at how we could make this better:</p>

<pre><code class="language-typescript">// A data$ stream
private data$: Observable&lt;Array&lt;Data&gt;&gt;;

// A function that uses this data$ 
doSomething() {
    const mapAllTheElementsActiveFlagToFalse = (data) =&gt; {
        if (data &amp;&amp; data.length &gt; 0) {
            return data.forEach(datum =&gt; {
                datum.active = false;
            });
        } else {
            return [];
        }
    };

    const callTheWhateverServiceForEveryElement = (data) =&gt; {
        data.forEach(datum =&gt; {
            this.whateverService.update(data);
        });
    }; 

    this.data$
    	.pipe(
    	  take(1),
          map(mapAllTheElementsActiveFlagToFalse),
          mergeMap(callTheWhateverServiceForEveryElement)
       ).subscribe();
}
</code></pre>

<p>I updated the code so that all the functions passed to the operators are first created as nested functions. This might feel a little weird at first, creating nested functions, but if we look at the last few lines of code, these have become so much cleaner. If you know what the operators of RxJS do, you can actually read what is happening (I must admit, naming these functions might not be my strongest feat :)). You only have to look at the last lines of this function. The implementation details of the nested functions is irrelevant (remember, declarative is easier to read).
I find this approach really helpful and tend to use it a lot, especially for functions that are longer than a single line.</p>

<h3 id="avoid-using-nested-observables">Avoid using nested observables</h3>

<p>RxJS provides us with a lot of operators which you can do a whole range of stuff with. One of them is combining different streams. One thing I sometimes see is this:</p>

<pre><code class="language-typescript">private data$: Observable&lt;Array&lt;Data&gt;&gt;;
private data2$: Observable&lt;Data2&gt;;

result$: Observable&lt;any&gt;;

doSomething() {
	 // we combine the data$ and data2$ with combineLatest
    this.result$ = combineLatest(
        this.data$
            .pipe(
               map(data =&gt; data.length),
            ),
        this.data2$
            .pipe(
               mergeMap(val =&gt; this.whateverService.call(val)),
            ),
        (val1, val2) =&gt; {
            // handle the values here   
        }
    );
}
</code></pre>

<p>We create an observable by using the <code>combineLatest</code> operator. But before we do so, the <code>data$</code> and <code>data2$</code> streams are transformed. You could say we are working with nested streams. And even though, the operators are aligned perfectly and there are no functions that are longer than one line, it still feels weird. Let’s see how we might be able to make it better:</p>

<pre><code class="language-typescript">private data$: Observable&lt;Array&lt;Data&gt;&gt;;
private data2$: Observable&lt;Data2&gt;;

result$: Observable&lt;any&gt;;

doSomething() {
    const dataLength$ = this.data$
        .pipe(
           map(data =&gt; data.length),
        ); 
    const whateverData$ = this.data2$
        .pipe(
           map(val =&gt; this.whateverService.call(val))
        );

	 // we combine the data$ and data2$ with combineLatest
    this.result$ = combineLatest(
        dataLength$,
        whateverData$,
        (val1, val2) =&gt; {
            // handle the values here   
        }
    );
}
</code></pre>

<p>This time, I extracted the nested observables and matched them to local variables first. I then use these newly created local variables to create a new stream using the <code>combineLatest</code> operator. 
By extracting nested observables to a separate variable and naming this new observable properly, the code is easier to understand.</p>

<p><strong>Conclusion</strong></p>

<p>Try to keep the following in mind when writing RxJS code:</p>

<ol>
  <li>Put every operator on a new line.</li>
  <li>Extract functions longer than a line to a nested function.</li>
  <li>Try to avoid working with nested observables.</li>
</ol>



            </section>

            <footer class="post-footer">

                <!-- Everything inside the #author tags pulls data from the author -->
                <!-- #author-->

                
                
                
                
                
                <figure class="author-image">
                    <a class="img" href="/author/kwintenp"
                       style="background-image: url(/assets/images/kwintenp.jpg)"><span class="hidden">kwintenp's Picture</span></a>
                </figure>
                

                <section class="author">
                    <h4><a href="/author/kwintenp">Kwinten Pisman</a></h4>

                    
                    <p> Freelance frontend architect. Occasional blogger. Reactive fan.</p>
                    
                    <div class="author-meta">
                        <span
                            class="author-location icon-location"> Belgium</span>
                        
                        <span class="author-link icon-twitter"><a
                            href="https://twitter.com/kwintenp"> https://twitter.com/kwintenp</a></span>
                    </div>
                </section>

                <!-- /author  -->

                <section class="share">
                    <h4>Share this post</h4>
                    <a class="icon-twitter"
                       href="http://twitter.com/share?text=Code formatting and RxJS&amp;url=https://blog.strongbrew.io/code-formatting-with-rxjs"
                       onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                        <span class="hidden">Twitter</span>
                    </a>
                    <a class="icon-facebook"
                       href="https://www.facebook.com/sharer/sharer.php?u=https://blog.strongbrew.io/code-formatting-with-rxjs"
                       onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
                        <span class="hidden">Facebook</span>
                    </a>
                    <a class="icon-google-plus"
                       href="https://plus.google.com/share?url=https://blog.strongbrew.io/code-formatting-with-rxjs"
                       onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
                        <span class="hidden">Google+</span>
                    </a>
                </section>
                
                

                <!-- Add Disqus Comments -->
                
                
                
                <div id="disqus_thread"></div>
<script>
    /**
     *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT
     *  THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR
     *  PLATFORM OR CMS.
     *
     *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT:
     *  https://disqus.com/admin/universalcode/#configuration-variables
     */
    /*
    var disqus_config = function () {
        // Replace PAGE_URL with your page's canonical URL variable
        this.page.url = PAGE_URL;

        // Replace PAGE_IDENTIFIER with your page's unique identifier variable
        this.page.identifier = PAGE_IDENTIFIER;
    };
    */

    (function() {  // REQUIRED CONFIGURATION VARIABLE: EDIT THE SHORTNAME BELOW
        var d = document, s = d.createElement('script');

        // IMPORTANT: Replace EXAMPLE with your forum shortname!
        s.src = 'https://kwintenpghostio.disqus.com/embed.js';

        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>
    Please enable JavaScript to view the
    <a href="https://disqus.com/?ref_noscript" rel="nofollow">
        comments powered by Disqus.
    </a>
</noscript>
                
                

            </footer>
        </div>

    </article>

</main>

<aside class="read-next">

    <!-- [[! next_post ]] -->
    
    <a class="read-next-story "
       style="background-image: url(/assets/images/cover/cover8.jpg)"
       href="/safe-image-requests-in-angular">
        <section class="post">
            <h2>Safe image requests in angular</h2>
            <p>We all know how to load images in a web-application right? We would just make...</p>
        </section>
    </a>
    
    <!-- [[! /next_post ]] -->
    <!-- [[! prev_post ]] -->
    
    <a class="read-next-story prev "
       style="background-image: url(/assets/images/cover/cover1.jpg)"
       href="/multicasting-operators-in-rxjs">
        <section class="post">
            <h2>Multicasting operators in RxJS</h2>
            <p>With the arrival of RxJS 5.4 a while back, the RxJS team has given us...</p>
        </section>
    </a>
    
    <!-- [[! /prev_post ]] -->
</aside>
<!-- /post -->


        <!-- The tiny footer at the very bottom -->
        <footer class="site-footer clearfix">
          <section class="copyright"><a href="/">Strongbrew</a> &copy; 2019</section>
          <section class="poweredby">Proudly published with <a href="https://jekyllrb.com/">Jekyll</a> using <a href="https://github.com/myjekyll/jasper">Jasper</a></section>
        </footer>
    </div>
    <!-- highlight.js -->
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.3.0/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>

    <!-- jQuery needs to come before `` so that jQuery can be used in code injection -->
    <script type="text/javascript" src="//code.jquery.com/jquery-1.12.0.min.js"></script>
    <!-- Ghost outputs important scripts and data with this tag -->
    <!--  -->
    <!-- Add Google Analytics  -->
        <!-- Google Analytics Tracking code -->
     <script>
	    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	    ga('create', 'UA-112030289-1', 'auto');
	    ga('send', 'pageview');

     </script>
    <!-- Fitvids makes video embeds responsive and awesome -->
    <script type="text/javascript" src="/assets/js/jquery.fitvids.js"></script>
    <!-- The main JavaScript file for Casper -->
    <script type="text/javascript" src="/assets/js/index.js"></script>
    <script type="text/javascript" src="/assets/js/prism.js"></script>
</body>
</html>
